<?xml version="1.0" encoding="UTF-8"?>
<ApprovalProcess xmlns="http://soap.sforce.com/2006/04/metadata">
    <active>false</active>
    <allowRecall>true</allowRecall>
    <allowedSubmitters>
        <type>owner</type>
    </allowedSubmitters>
    <approvalPageFields>
        <field>CaseNumber</field>
        <field>Subject</field>
        <field>Owner</field>
        <field>Opportunity__c</field>
        <field>Customer_Type__c</field>
        <field>Product_Type__c</field>
        <field>Program_Type__c</field>
        <field>Autosweep__c</field>
        <field>MCC_Restrictions__c</field>
        <field>Generic_Card_Request__c</field>
        <field>No_Cards__c</field>
        <field>KYB_Passed__c</field>
        <field>KYC_Passed__c</field>
        <field>Fees_Set_Up__c</field>
        <field>Admins_Created__c</field>
        <field>MCC_Blocks__c</field>
        <field>Application_Sent_To_Valitor__c</field>
        <field>X3rd_Party_API_Informed__c</field>
        <field>Account_Set_Up_In_Portal__c</field>
        <field>Manual_Billing_Required__c</field>
        <field>MilestoneStatusIcon</field>
    </approvalPageFields>
    <approvalStep>
        <allowDelegate>false</allowDelegate>
        <approvalActions>
            <action>
                <name>Client_Operations_Director_Approval</name>
                <type>FieldUpdate</type>
            </action>
        </approvalActions>
        <assignedApprover>
            <approver>
                <name>daniel.ibrahim@wexeurope.com</name>
                <type>user</type>
            </approver>
            <whenMultipleApprovers>FirstResponse</whenMultipleApprovers>
        </assignedApprover>
        <entryCriteria>
            <criteriaItems>
                <field>Case.Program_Type__c</field>
                <operation>contains</operation>
                <value>High Limit</value>
            </criteriaItems>
        </entryCriteria>
        <ifCriteriaNotMet>ApproveRecord</ifCriteriaNotMet>
        <label>Compliance Approval</label>
        <name>Compliance_Approval</name>
    </approvalStep>
    <approvalStep>
        <allowDelegate>true</allowDelegate>
        <approvalActions>
            <action>
                <name>Application_Submitted</name>
                <type>FieldUpdate</type>
            </action>
            <action>
                <name>High_Limit_Account_Approved</name>
                <type>FieldUpdate</type>
            </action>
        </approvalActions>
        <assignedApprover>
            <approver>
                <name>jakub.zmuda@wexeurope.com</name>
                <type>user</type>
            </approver>
            <whenMultipleApprovers>FirstResponse</whenMultipleApprovers>
        </assignedApprover>
        <entryCriteria>
            <criteriaItems>
                <field>Case.Program_Type__c</field>
                <operation>contains</operation>
                <value>High Limit</value>
            </criteriaItems>
        </entryCriteria>
        <label>Client Operations Director Approval</label>
        <name>Client_Operations_Director_Approval</name>
        <rejectBehavior>
            <type>BackToPrevious</type>
        </rejectBehavior>
    </approvalStep>
    <description>For High Limit approval by Compliance Manager &amp; Client Operations Director, then by Wex Europe Customer Services manager to approve an account which has been newly created on the portal.

Will be submitted from JavaScript custom button or Process Builder (Case Record Type &amp; Program Type contains &apos;High Limit&apos;).

Update CS New Application email notification criteria, to only fire if the Program Type&apos;s not High Limit, before activation.</description>
    <enableMobileDeviceAccess>false</enableMobileDeviceAccess>
    <entryCriteria>
        <formula>AND( 
RecordTypeId = &apos;012700000005x2r&apos;,

/* do not remove this criteria as it needs to be evaluated when normal application is submitted
*/ 
CONTAINS(Program_Type__c, &apos;High Limit&apos;) 
)</formula>
    </entryCriteria>
    <finalApprovalActions>
        <action>
            <name>High_Limit_Application_Submitted</name>
            <type>Alert</type>
        </action>
    </finalApprovalActions>
    <finalApprovalRecordLock>true</finalApprovalRecordLock>
    <finalRejectionRecordLock>false</finalRejectionRecordLock>
    <initialSubmissionActions>
        <action>
            <name>Compliance_Approval_Requested</name>
            <type>FieldUpdate</type>
        </action>
    </initialSubmissionActions>
    <label>Account Approval Process</label>
    <nextAutomatedApprover>
        <useApproverFieldOfRecordOwner>false</useApproverFieldOfRecordOwner>
        <userHierarchyField>Manager</userHierarchyField>
    </nextAutomatedApprover>
    <recordEditability>AdminOnly</recordEditability>
    <showApprovalHistory>true</showApprovalHistory>
</ApprovalProcess>
